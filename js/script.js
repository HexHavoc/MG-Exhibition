const STORE = {
  questions:[
      {
        question: "In which year did Mahatma Gandhi return to India from South Africa?",
        code: ``,
        answers: ["1918", "1910", "1915", "1905"],
        correctAnswer: "1915",
      },
      {
        question: "What is Mahatma Gandhi's full name?",
        code: ``,
        answers: [
          "Mohandas Karamchand Gokhale",
          "Mohandas Karamchand Patel",
          "Mohandas Karamchand Gandhi",
          "Mohandas Karamchand Nehru",
        ],
        correctAnswer: "Mohandas Karamchand Gandhi",
      },
      {
        question: "Where was Mahatma Gandhi born?",
        code: ``,
        answers: ["Ahmedabad", "Porbandar", "Delhi", "Mumbai"],
        correctAnswer: "Porbandar",
      },
      {
        question: "What was the name of Mahatma Gandhi's mother?",
        code: ``,
        answers: ["Putlibai", "Kasturba", "Leelawati", "Sharda Bai"],
        correctAnswer: "Putlibai",
      },
      {
        question: "In which year did Gandhiji pass his matriculation examination in England?",
        code: ``,
        answers: ["1889", "1890", "1891", "1892"],
        correctAnswer: "1890",
      },
      {
        question: "What was the main objective of the non-cooperation movement?",
        code: ``,
        answers: [
          "Achieving complete independence from British rule",
          "Demanding separate electorates for Hindus and Muslims",
          "Promoting communal harmony",
          "Seeking economic reforms only",
        ],
        correctAnswer: "Achieving complete independence from British rule",
      },
      {
        question: "Which movement aimed at promoting self-reliance among Indians by boycotting foreign goods?",
        code: ``,
        answers: ["Khilafat Movement", "Swadeshi Movement", "Non-Cooperation Movement", "Civil Disobedience Movement"],
        correctAnswer: "Swadeshi Movement",
      },
      {
        question: "What significant event began on March 12, 1930 in Gandhi's Civil Disobedience Movement?",
        code: ``,
        answers: [
          "Jallianwala Bagh massacre",
          "Dandi March (Salt March)",
          "Quit India Movement",
          "Chauri Chaura incident",
        ],
        correctAnswer: "Dandi March (Salt March)",
      },
      {
        question: "Which famous slogan is associated with Mahatma Gandhi during the Quit India Movement?",
        code: ``,
        answers: ["Give me liberty or give me death!", "Do or die!", "I have a dream!", "Power to the people!"],
        correctAnswer: "Do or die!",
      },
      {
        question: "Who was the political guru of Mahatma Gandhi?",
        code: ``,
        answers: ["Bal Gangadhar Tilak", "Gopal Krishna Gokhale", "Rabindranath Tagore", "Jawaharlal Nehru"],
        correctAnswer: "Gopal Krishna Gokhale",
      },
      {
        question: "Who was Mahatma Gandhi's wife?",
        code: ``,
        answers: ["Indira Gandhi", "Kasturba Gandhi", "Rajkumari Amrit Kaur", "Sarojini Naidu"],
        correctAnswer: "Kasturba Gandhi",
      },
      {
        question: "How many children did Mahatma Gandhi have?",
        code: ``,
        answers: ["Two", "Three", "Four", "Five"],
        correctAnswer: "Four",
      },
      {
        question: "What was the name of Mahatma Gandhi's mother?",
        code: ``,
        answers: ["Putlibai", "Kasturba", "Leelawati", "Sharda Bai"],
        correctAnswer: "Putlibai",
      },
      {
        question: "What was the title given to Gandhi by Rabindranath Tagore?",
        code: ``,
        answers: ["Bapu", "Mahatma", "Father of the Nation", "Sardar"],
        correctAnswer: "Mahatma",
      },
      {
        question: "Where did Mahatma Gandhi receive his law degree?",
        code: ``,
        answers: ["Harvard University", "University College London", "Cambridge University", "University of Bombay"],
        correctAnswer: "University College London",
      },
      {
        question: "What does 'Ahimsa' mean?",
        code: ``,
        answers: ["Peaceful coexistence", "Non-violence", "Truthfulness", "Community service"],
        correctAnswer: "Non-violence",
      },
      {
        question: "Which famous quote is attributed to Mahatma Gandhi regarding non-violence?",
        code: ``,
        answers: [
          "Peace is not merely the absence of war",
          "An eye for an eye makes the whole world blind",
          "Be the change you wish to see in the world",
          "Injustice anywhere is a threat to justice everywhere",
        ],
        correctAnswer: "An eye for an eye makes the whole world blind",
      },
      {
        question: "What did Gandhiji refer to as 'Harijan'?",
        code: ``,
        answers: ["Untouchables", "Freedom fighters", "Farmers", "Women"],
        correctAnswer: "Untouchables",
      },
      {
        question: "What does 'Sarvodaya' mean in Gandhian philosophy?",
        code: ``,
        answers: ["Universal welfare", "Individual success", "Nationalism", "Economic growth"],
        correctAnswer: "Universal welfare",
      },
      {
        question: "What was Gandhi's stance on industrialization?",
        code: ``,
        answers: [
          "As essential for progress",
          "As harmful to society",
          "As beneficial for agriculture",
          "As irrelevant to India",
        ],
        correctAnswer: "As harmful to society",
      },
      {
        question: "When did Mahatma Gandhi first visit South Africa?",
        code: ``,
        answers: ["1893", "1900", "1905", "1910"],
        correctAnswer: "1893",
      },
      {
        question: "What significant event happened on January 30, 1948?",
        code: ``,
        answers: ["Gandhi's birthday", "Independence Day", "Gandhi's assassination", "Quit India Movement"],
        correctAnswer: "Gandhi's assassination",
      },
      {
        question: "Who assassinated Mahatma Gandhi?",
        code: ``,
        answers: ["Bhagat Singh", "Nathuram Godse", "Subhas Chandra Bose", "Rajguru"],
        correctAnswer: "Nathuram Godse",
      },
      {
        question: "In which state is Gandhiji's birthplace located?",
        code: ``,
        answers: ["Maharashtra", "Gujarat", "Rajasthan", "Punjab"],
        correctAnswer: "Gujarat",
      },
      {
        question: "How many times did Mahatma Gandhi go on hunger strikes?",
        code: ``,
        answers: ["Five times", "Ten times", "Over seventeen times", "Never went on hunger strikes"],
        correctAnswer: "Over seventeen times",
      },
      {
        question: "Where did Mahatma Gandhi receive his law degree?",
        code: ``,
        answers: ["Harvard University", "University College London", "Cambridge University", "University of Bombay"],
        correctAnswer: "University College London",
      },
      {
        question: "Which Indian state is known as Gandhiji's birthplace?",
        code: ``,
        answers: ["Maharashtra", "Gujarat", "Rajasthan", "Punjab"],
        correctAnswer: "Gujarat",
      },
      {
        question: "What was the primary goal of Mahatma Gandhi's 'Constructive Programme'?",
        code: ``,
        answers: ["Promote violence", "Encourage communal riots", "Foster rural development", "Support foreign trade"],
        correctAnswer: "Foster rural development",
      },
      {
        question: "Who assassinated Mahatma Gandhi?",
        code: ``,
        answers: ["Bhagat Singh", "Nathuram Godse", "Subhas Chandra Bose", "Rajguru"],
        correctAnswer: "Nathuram Godse",
      },
      {
        question: "Where did Mahatma Gandhi establish his last ashram?",
        code: ``,
        answers: ["Delhi", "Sevagram", "Sabarmati", "Dandi"],
        correctAnswer: "Sevagram",
      },
      {
        question: "What was the primary focus of the All-India Khilafat Conference in 1919?",
        code: ``,
        answers: [
          "To promote Hindu unity",
          "To support the Ottoman Empire",
          "To demand independence from British rule",
          "To establish a separate Muslim state",
        ],
        correctAnswer: "To support the Ottoman Empire",
   
      },
  ]
  }


  function createTimer(duration, onTick, onComplete) {
    let remainingTime = duration;
    let timerInterval;
  
    function startTimer() {
      remainingTime = duration; // Reset remaining time when starting
      clearInterval(timerInterval); // Clear any existing interval
      timerInterval = setInterval(() => {
        remainingTime--;
        onTick(remainingTime);
  
        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          onComplete();
        }
      }, 1000);
    }
  
    function stopTimer() {
      clearInterval(timerInterval);
    }
  
    return {
      start: startTimer,
      stop: stopTimer,
      getRemainingTime: () => remainingTime,
    };
  }

  // Update the timer display
  function updateTimerDisplay(time) {
    const minutes = Math.floor(time / 60);
    const seconds = time % 60;
    const displayTime = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
    $(".timer").text(displayTime);
  
    if (time <= 60) {
      $(".timer").addClass("timer-warning");
    } else {
      $(".timer").removeClass("timer-warning");
    }
  }
  
  // Handle timer completion
  function handleTimerComplete(quizData) {
    quizData.completed = true;
    $(".answer-btn").prop("disabled", true);
    $(".progress, .progress-bar, .timer").hide();
    $fade(quizData);
  }



  function makeQuiz() {
    // Get all questions from STORE
    const allQuestions = STORE.questions;
    
    // Create a shuffled copy of the questions array
    const shuffledQuestions = [...allQuestions]
      .map(value => ({ value, sort: Math.random() }))
      .sort((a, b) => a.sort - b.sort)
      .map(({ value }) => value);
    
    // Take the first 10 questions
    const selectedQuestions = shuffledQuestions.slice(0, 10);
  
    return {
      questions: selectedQuestions,
      midQuiz: false,
      progress: {
        progressBar: [],
        incorrectCategories: [],
      },
      completed: false,
      currentQuestion: 0,
      correctAnswers: 0,
      currentAnswer: "",
      pointCorrect: 0,
      timer: null,
      totalTime: 150,
      remainingTime: 150,
    };
  }
  
  // Update helpers object
  const helpers = {
    // Remove the old question selection methods since we're not using them anymore
    shuffleAnswers: (arr) => {
      for (var i = arr.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
      }
    },
    updateProgressBar: (appState) => {
      $(".progress-bar").empty();
      appState.progress.progressBar.forEach((progInd) => {
        $(".progress-bar").append(progInd);
      });
    }
  };
  
  // Initialize quiz and event handlers
  $(() => {
    let quizData;
  
    function initializeNewQuiz() {
      if (quizData && quizData.timer) {
        quizData.timer.stop();
      }
      
      quizData = makeQuiz();
      
      // Reset and show timer
      $(".timer").removeClass("hide timer-warning").show();
      updateTimerDisplay(quizData.totalTime);
  
      // Create and start timer
      quizData.timer = createTimer(
        quizData.totalTime,
        (remainingTime) => {
          updateTimerDisplay(remainingTime);
          quizData.remainingTime = remainingTime;
        },
        () => handleTimerComplete(quizData)
      );
      quizData.timer.start();
  
      $fade(quizData);
    }
  
    // Start quiz with timer
    $(".start-quiz, .retry-btn").on("click", initializeNewQuiz);
  
    // Stop timer if quiz is quit
    $(".quit-quiz").on("click", () => {
      if (quizData && quizData.timer) {
        quizData.timer.stop();
      }
      killQuiz();
    });
  });
  
  // Modify $showResults to show remaining time
  function $showResults(appState) {
    const endMsg = `You got ${appState.pointCorrect} points`
    const timeLeft = appState.remainingTime
  
    $(".quiz-end-score").html(endMsg)
  
    // Ensure progress bar and timer remain hidden
    $(".progress, .progress-bar, .timer").hide()
  
    // Rest of existing $showResults logic...
  }
  
  // Apply fadeOut animations and set the stage for DOM text/element changes
  function $fade(appState) {
    // This is the completed state of of a quiz
    if (appState.completed) {
      // Fade out elements with a promise to avoid choppy behavior
      $.when($(".question-answer-wrapper, .question-wrapper, .answer-wrapper").fadeOut(500)).done(() => {
        // Display results of the quiz
        $showResults(appState)
        $(".results-wrapper").hide().removeClass("hide")
        $(".question-answer-wrapper, .results-wrapper").fadeIn(500)
      })
  
      // This is if the app is just starting
    } else if (appState.midQuiz === false) {
      // Set a flag that the app has begun
      appState.midQuiz = true
      // Fade out elements with a promise to avoid choppy behavior
      $.when(
        $(
          ".question-answer-wrapper, .question-wrapper, .code, .answer-wrapper, .start-quiz, .quit-quiz, .results-wrapper, .progress, .progress-bar",
        ).fadeOut(500),
      ).done(() => {
        // Remove any progress from a previous quiz (if any);
        helpers.updateProgressBar(appState)
        $(".progress-count").html("1 / 10")
        $(".progress-perc").html("  // 0 points")
        $(".question").css("font-size", "1.75rem")
        // Kill previous results
        $(".failures").remove()
        // Lots to do... mostly just setting up a new environment for a new quiz
        $updateQuestion(appState)
        $("progress-bar").empty()
        $("progress-fill").html('Progress: <span class="progress-count">1 / 10</span><span class="progress-perc"></span>')
        $(".question-answer-wrapper, .answer-wrapper").removeClass("begin")
        $(".submit-btn, .progress, .progress-bar").removeClass("hide")
        $(".timer").removeClass("hide").show()
        $(".progress, .progress-bar").hide()
        $(".question-answer-wrapper, .question-wrapper, .answer-wrapper, .progress, .progress-bar").fadeIn(500)
        if (!$(".code").hasClass("hide")) {
          $(".code").fadeIn(500)
        }
      })
  
      // This is if the app is in the middle of execution
    } else if (appState.midQuiz) {
      $.when($(".question-answer-wrapper, .question-wrapper, .answer-wrapper").fadeOut(500)).done(() => {
        $updateQuestion(appState)
        $(".question-answer-wrapper, .question-wrapper, .answer-wrapper").fadeIn(500)
      })
    }
  }
  
  // Update the question, code, answers, buttons in the DOM while we're in a faded out state
  function $updateQuestion(appState) {
    $(".answer-btn").remove()
  
    // Update the question and code text with the current question
    $(".question").html(appState.questions[appState.currentQuestion].question)
  
    // This is a hack to hide/show the code portion
    // Only 1/3 of the questions contain code so we hide it if they aren't present
    if (appState.questions[appState.currentQuestion].code == ``) {
      $(".code").addClass("hide")
    } else {
      $(".code").removeClass("hide")
      $(".code").html(`<pre>${appState.questions[appState.currentQuestion].code}</pre>`)
    }
  
    // Change continue back to submit
    $(".continue-btn").val("Submit").removeClass("continue-btn").addClass("submit-btn").prop("disabled", true)
  
    // Add in available answers for the question
    const $answers = []
  
    // Adding the answers to a temporary array
    for (let i = 0; i < appState.questions[appState.currentQuestion].answers.length; i++) {
      // Add current question answers to an array
      const $answer = $('<button class="answer-btn" type="button"></button>')
      $answer.html(appState.questions[appState.currentQuestion].answers[i])
      $answers.push($answer)
    }
  
    // Shuffle the answers
    helpers.shuffleAnswers($answers)
  
    // Push answers to the DOM
    $answers.forEach((answer) => {
      $(".answer-wrapper").prepend(answer)
    })
  }
  
  // Simple class and enable/disable DOM selection when answer is selected
  function selectAnswer(answer) {
    $(".answer-btn").removeClass("selected")
    answer.addClass("selected")
    $(".submit-btn").prop("disabled", false)
  }
  
  // Answer is selected and submitted
  // Push a feedback state
  function submitAnswer(appState) {
    let correct
  
    $(".answer-btn").each(function () {
      if ($(this).html() === appState.questions[appState.currentQuestion].correctAnswer) {
        $(this).addClass("pass")
  
        // If answer is correct and selected
        if ($(this).hasClass("selected")) {
          correct = "pass"
          appState.pointCorrect += 10 // Ensure point increment
          appState.correctAnswers++
        }
      } else if ($(this).hasClass("selected")) {
        $(this).addClass("fail dim-answer")
        correct = "fail"
        appState.progress.incorrectCategories.push(appState.questions[appState.currentQuestion].category)
      } else {
        $(this).addClass("dim-answer")
      }
    })
  
    // Rest of the function remains the same
    appState.progress.progressBar.push(`<div class="progress-indicator ${correct}"></div>`)
  
    $(".progress-count").html(`
          ${appState.currentQuestion + 1} / ${appState.questions.length}
      `)
  
    $(".progress-perc").html(`
           // ${appState.pointCorrect} points
      `)
  
    $(".submit-btn").val("Continue").removeClass("submit-btn").addClass("continue-btn")
  
    $(".answer-btn").prop("disabled", true)
  
    helpers.updateProgressBar(appState)
  
    appState.currentQuestion++
  
    if (appState.currentQuestion === appState.questions.length) {
      appState.completed = true
    }
  }
  
  // Silly easter egg for saying you don't want to do the quiz
  function killQuiz() {
    $(".start-quiz, .quit-quiz").hide()
    const failureMsg = "Just try, If you didn't like it then quit :)"
    const msgSplit = failureMsg.split(" ")
    let counter = 0
    $(".question").empty()
    const startTroll = setInterval(() => {
      $(".question").append(msgSplit[counter] + " ")
      counter++
      if (counter > msgSplit.length - 1) {
        clearInterval(startTroll)
        $(".start-quiz").text("Just try! Start Quiz").fadeIn(500)
      }
    }, 250)
  }
  

  // Lets start the show
  $(() => {
    // Kill any form refresh
    $(".answer-wrapper").on("submit", (e) => {
      e.preventDefault()
    })
  
    // Storage for quiz app state
    let quizData
  
    // Start quiz
    $(".start-quiz, .retry-btn").on("click", () => {
      quizData = makeQuiz()
      $(".timer").hide();
      $fade(quizData)
    })
  
    // Select an answer
    $(".question-answer-wrapper").on("click", ".answer-btn", function () {
      selectAnswer($(this))
    })
  
    // Submit your answer to display feedback and advance question counter
    $(".question-answer-wrapper").on("click", ".submit-btn", (e) => {
      submitAnswer(quizData)
    })
  
    // Submit your answer to display feedback and advance question counter
    $(".question-answer-wrapper").on("click", ".continue-btn", () => {
      $fade(quizData)
    })
  
    // Easter egg to chastize the user
    $(".quit-quiz").on("click", () => {
      killQuiz()
    })
  })
  
  